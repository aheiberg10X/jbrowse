include<tables.txt>
genome NA18506;

H1=select * from READS 
where location>=0 and mate_loc>=0 and 
(
	(mate_loc-location>1000 and mate_loc-location<2000000 and strand=='R' and mate_strand=='F') 
or 
	(location-mate_loc>1000 and location-mate_loc<2000000 and strand=='F' and mate_strand=='R')
)

H2=select create_intervals() from H1 using intervals(location, location+length)


H3=select merge_intervals(interval_count > 5) from H2

out=select * from MAPJOIN H3, H1 using intervals(location, location+length, both_mates)

print out
