include<tables.txt>
genome NA18506;

H1=select * from READS 
where location>=0 and mate_loc>=0 and 
(
	(mate_loc-location>1000 and mate_loc-location<100000) 
or 
	(location-mate_loc>1000 and location-mate_loc<100000)
)

C1=select * from READS
where location>=0 and mate_loc>=0 and
(
	(mate_loc+100-location>250 and mate_loc+100-location<400) 
or 
	(location+100-mate_loc>250 and location+100-mate_loc<400)
)

H2=select create_intervals() from H1 using intervals(location, mate_loc, both_mates)


H3=select merge_intervals(interval_count > 5) from H2

out=select * from MAPJOIN H3, H1 using intervals(location, mate_loc, both_mates)

out_left=select * from MAPJOIN H3, C1 using intervals(location+1000, mate_loc+1000, both_mates)

out_right=select * from MAPJOIN H3, C1 using intervals(location-1000, mate_loc-1000, both_mates)

out_center=select * from MAPJOIN H3, C1 using intervals(location, mate_loc, both_mates)

print out
print out_left
print out_right
print out_center
